<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Alternating Harmonic Game — Arbitrary Precision</title>
<style>
body { font-family: sans-serif; padding: 2rem; max-width: 700px; margin: auto; }
.stats { margin: 1rem 0; }
button { padding: 0.5rem 1rem; margin-right: 1rem; }
</style>
</head>
<body>
<h1>Alternating Harmonic Series Game (Arbitrary Precision)</h1>
<p>All sums use exact rational arithmetic with BigInt.</p>


<div class="stats">
<div><strong>Target:</strong> <span id="target"></span></div>
<div><strong>Current Sum:</strong> <span id="current"></span></div>
<div><strong>Error:</strong> <span id="error"></span></div>
<div><strong>Next Positive Term:</strong> <span id="nextPos"></span></div>
<div><strong>Next Negative Term:</strong> <span id="nextNeg"></span></div>
</div>


<div class="buttons">
<button id="usePos">Use Positive Term</button>
<button id="useNeg">Use Negative Term</button>
</div>


<script>
// --- Rational Arithmetic (BigInt) ---
function gcd(a, b) {
a = a < 0n ? -a : a;
b = b < 0n ? -b : b;
while (b !== 0n) [a, b] = [b, a % b];
return a;
}


function norm([n, d]) {
const g = gcd(n, d);
d = d / g;
n = n / g;
if (d < 0n) { n = -n; d = -d; }
return [n, d];
}


function add(a, b) {
return norm([a[0]*b[1] + b[0]*a[1], a[1]*b[1]]);
}


function sub(a, b) {
return norm([a[0]*b[1] - b[0]*a[1], a[1]*b[1]]);
}


function toDecimal([n, d], digits = 30) {
const factor = 10n ** BigInt(digits);
const scaled = (n * factor) / d;
const s = scaled.toString();
const intPart = s.length > digits ? s.slice(0, -digits) : '0';
const frac = s.padStart(digits, '0').slice(-digits);
return intPart + "." + frac;
}


// --- Game State ---
let nPos = 1n;
let nNeg = 2n;
let current = [0n, 1n];


// random target in [-2,2], expressed as rational with scale 10^30
const DIGITS = 30;
const scale = 10n ** BigInt(DIGITS);
const rand = Math.random(); // double
const target = norm([BigInt(Math.floor(rand * Number(scale))), scale]);


// elements
const targetEl = document.getElementById('target');
const currentEl = document.getElementById('current');
const errorEl = document.getElementById('error');
const nextPosEl = document.getElementById('nextPos');
const nextNegEl = document.getElementById('nextNeg');


function displayR(r) {
return toDecimal(r, 30);
}


function updateDisplay() {
nextPosEl.textContent = displayR([1n, nPos]);
nextNegEl.textContent = displayR([-1n, nNeg]);
currentEl.textContent = displayR(current);
const err = sub(current, target);
// absolute value
const absErr = err[0] < 0n ? [-err[0], err[1]] : err;
errorEl.textContent = displayR(absErr);
targetEl.textContent = displayR(target);
}


document.getElementById('usePos').onclick = () => {
current = add(current, [1n, nPos]);
nPos += 2n;
updateDisplay();
};


document.getElementById('useNeg').onclick = () => {
current = add(current, [-1n, nNeg]);
nNeg += 2n;
updateDisplay();
};


updateDisplay();
</script>
</body>
</html>